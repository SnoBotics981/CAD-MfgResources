/* 12/18/2018 8:34:34 PM, 1005*/
if (window.performance && performance.mark) performance.mark('scriptcombiner start: BqA9BrBAA8ASAmA0B6');
(function(){window.Activity||(window.Activity={});window.Activity.Models||(window.Activity.Models={});if(!window.Activity.Models.Notification){var d={"0":"on Sunday",1:"on Monday",2:"on Tuesday",3:"on Wednesday",4:"on Thursday",5:"on Friday",6:"on Saturday"},e={"0":"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};window.Activity.Models.Notification=Backbone.Model.extend({idAttribute:"Id",defaults:{Id:0,EntityId:"",
Type:0,Message:"",VisitorId:0,CreateTimestamp:"",ExpireTimestamp:"",Status:0},initialize:function(a){this.Id=a.Id;this.EntityId=a.EntityId;this.Type=a.Type;this.Message=a.Message;this.VisitorId=a.VisitorId;this.CreateTimestamp=a.CreateTimestamp;this.ExpireTimestamp=a.ExpireTimestamp;this.Status=a.Status;var b=this.decodeHTMLEntities(a.Message.text);this.set({displayText:b.replace("{{DATE}}",this.messageDateFormatter(a.Message.date))})},url:function(){return"/HTTPHandlers/UpdateNotification.aspx?id="+
this.Id+"&status="+this.attributes.Status+"&visitorId="+this.attributes.VisitorId},messageDateFormatter:function(a){var b=new Date;b.setHours(24,0,0,0);a=a.replace("Z","");a=new Date(a);var b=Math.floor((b.getTime()-a.getTime())/864E5),c=a.toLocaleTimeString().replace(/[^\x00-\x7F]/g,"").replace(/:\d+ /," ").replace(" ","").toLowerCase();switch(b){case 0:return"today at "+c;case 1:return"yesterday";case 2:case 3:case 4:case 5:case 6:return a=a.getDay(),d[a];default:return c=e[a.getMonth()],a=a.getDate(),
0<b&&7>=b?"on "+c+" "+a:""}},decodeHTMLEntities:function(a){var b=document.createElement("textarea");b.innerHTML=a;return b.value}})}})();


(function(){window.Activity||(window.Activity={});window.Activity.ItemViews||(window.Activity.ItemViews={});window.Activity.ItemViews.Notification||(window.Activity.ItemViews.Notification=Backbone.Marionette.ItemView.extend({template:Handlebars.templates.notification,tagName:"li",className:"notification-item",events:{click:"read","click .notification-ex-container":"dismiss","mouseover .notification-ex-container":"exHoverOn","mouseout .notification-ex-container":"exHoverOff",mouseover:"highlight",
mouseout:"removeHighlight"},onRender:function(){this._UNREAD=0;this._READ=1;this._DISMISS=2;this.$el.html(this.template(this.model.attributes));return this},read:function(a){a&&a.stopPropagation();this.updateStatus(this._READ);a=$.parseXML(this.model.get("EntityId"));var b;$(a).find("kyComp").each(function(){"MONGO_ID"===this.getAttribute("nm")&&(b=this.getAttribute("val").toLowerCase())});a=new McMaster.MsgMgr.Hdr(McMaster.MsgMgr.CntxtNms.NOTIFICATION_SELECTED);a=new McMaster.MsgMgrMsgs.NotificationSelected(a,
b);McMaster.MsgMgr.PubMsg(a);Trkr.Trk(Trkr.UserActions.notification_select.Make(),[Trkr.ActionAttributes.notification_id.Make(this.model.Id),Trkr.ActionAttributes.action_location.Make("Notification Center")])},dismiss:function(a){a.stopPropagation();a.preventDefault();this.updateStatus(this._DISMISS);Trkr.Trk(Trkr.UserActions.notification_dismiss.Make(),Trkr.ActionAttributes.notification_id.Make(this.model.Id))},updateStatus:function(a){this.model.set({Status:a});var b;b=Cmn.AddQSNmVal("/HTTPHandlers/UpdateNotification.aspx",
"id",this.model.Id);b=Cmn.AddQSNmVal(b,"status",this.model.attributes.Status);mCnxn=McMaster.CnxnMgr.PerformAjaxCnxn(b,{success:function(a){mCnxn=null},failure:function(){mCnxn=null},abort:function(){mCnxn&&(McMaster.CnxnMgr.AbortAjaxCnxn(mCnxn),mCnxn=null)},cnxnParm:{respTyp:"JSON"}});this.remove();this.unbind();a===this._DISMISS?(this.triggerMethod("dismissed:notification"),this.triggerMethod("dismissed:notificationList")):a===this._READ&&this.triggerMethod("read:notification")},exHoverOn:function(){this.hide(".notification-ex");
this.show(".notification-ex-hover")},exHoverOff:function(){this.show(".notification-ex");this.hide(".notification-ex-hover")},highlight:function(){this.$el.addClass("notification-highlight")},removeHighlight:function(){this.$el.removeClass("notification-highlight")},hide:function(a){$(a,this.$el).addClass("hidden")},show:function(a){$(a,this.$el).removeClass("hidden")}}))})();


(function(){window.Activity||(window.Activity={});window.Activity.Models||(window.Activity.Models={});window.Activity.Models.NotificationCenterBadge||(window.Activity.Models.NotificationCenterBadge=Backbone.Model.extend({defaults:{numberNotifications:0}}))})();


(function(){window.Activity||(window.Activity={});window.Activity.ItemViews||(window.Activity.ItemViews={});window.Activity.ItemViews.NotificationCenterBadge||(window.Activity.ItemViews.NotificationCenterBadge=Backbone.Marionette.ItemView.extend({template:Handlebars.templates["notification-center-badge"],tagName:"div",className:"notification-center-badge",onRender:function(){this.$el.parent().hasClass("hidden")&&0<this.model.attributes.numberNotifications?this.$el.parent().removeClass("hidden"):0===
this.model.attributes.numberNotifications&&this.$el.parent().addClass("hidden");this.$el.html(this.template(this.model.attributes));return this}}))})();


(function(){window.Activity||(window.Activity={});window.Activity.ItemViews||(window.Activity.ItemViews={});if(!window.Activity.ItemViews.NewNotification){var c=!1;(function(){var a=document.createElement("fakeelement"),b={transition:"transitionend"},d;for(d in b)void 0!==a.style[d]&&(c=b[d])})();var e={"0":"GENERIC",1:"DELIVERY"};window.Activity.ItemViews.NewNotification=Backbone.Marionette.ItemView.extend({template:Handlebars.templates.notification,tagName:"div",className:"new-notification-item",
events:{click:"read",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave"},initialize:function(){},onRender:function(){this._UNREAD=0;this._READ=1;this._DISMISS=2;this.$el.html(this.template(this.model.attributes));return this},read:function(a){this.updateStatus(this._READ);a=$.parseXML(this.model.get("EntityId"));var b;$(a).find("kyComp").each(function(){"MONGO_ID"===this.getAttribute("nm")&&(b=this.getAttribute("val").toLowerCase())});this.removeAndClose();a=new McMaster.MsgMgr.Hdr(McMaster.MsgMgr.CntxtNms.NOTIFICATION_SELECTED);
a=new McMaster.MsgMgrMsgs.NotificationSelected(a,b);McMaster.MsgMgr.PubMsg(a);Trkr.Trk(Trkr.UserActions.notification_select.Make(),[Trkr.ActionAttributes.notification_id.Make(this.model.Id),Trkr.ActionAttributes.action_location.Make("New Notification Dropdown")])},updateStatus:function(a){this.model.set({Status:a});this.model.save()},removeAndClose:function(){$(".new-notification-container").css({"overflow-y":"hidden","max-height":0,height:0,opacity:0}).scrollTop(0)},handleMouseEnter:function(){this.mouseenter=
!0;Trkr.Trk(Trkr.MinorActions.new_notification_hover.Make(),Trkr.ActionAttributes.notification_id.Make(this.model.Id))},showNewNotification:function(){var a=this;$(".new-notification-container").removeClass("new-notif-hide");c?($(".new-notification-container").on("click",function(){a.slideUpNewNotif}).css({height:this.$el.outerHeight()}),$(".new-notification-container").addClass("new-notif-show"),setTimeout(a.slideUpNewNotif,4500,a)):($(".new-notification-container").on("click",function(){a.slideUpNewNotif}).css({height:this.$el.outerHeight(),
opacity:1}),setTimeout(function(a){return function(){a.slideUpNewNotif(a)}}(a),4500));Trkr.Trk(Trkr.MinorActions.new_notification_dropdown.Make(),[Trkr.ActionAttributes.notification_id.Make(this.model.Id),Trkr.ActionAttributes.notification_type.Make(e[this.model.Type])])},slideUpNewNotif:function(a){a.mouseenter||(c?($(".new-notification-container").removeClass("new-notif-show"),$(".new-notification-container").addClass("new-notif-hide"),$(".new-notification-container").css({height:0})):$(".new-notification-container").css({height:0,
opacity:0}));a.triggerMethod("done:newnotification")},handleMouseLeave:function(){this.mouseenter=!1;this.slideUpNewNotif(this)}})}})();


(function(){void 0===window.Activity&&(window.Activity={});void 0===window.Activity.Collections&&(window.Activity.Collections={});window.Activity.Collections.Notification||(window.Activity.Collections.Notification=Backbone.Collection.extend({model:window.Activity.Models.Notification,comparator:function(a,b){return a.get("CreateTimestamp")>b.get("CreateTimestamp")?-1:1}}))})();


(function(){window.Activity||(window.Activity={});window.Activity.CollectionViews||(window.Activity.CollectionViews={});window.Activity.CollectionViews.Notification||(window.Activity.CollectionViews.Notification=Backbone.Marionette.CollectionView.extend({childView:window.Activity.ItemViews.Notification,tagName:"ul",className:"notifications-list",filter:function(a,b,c){return 0===a.get("Status")},onAddChild:function(a){this.$el.prepend(a.el);this.triggerMethod("render:badge")}}))})();


(function(){window.Activity||(window.Activity={});window.Activity.ItemViews||(window.Activity.ItemViews={});if(!window.Activity.ItemViews.NotificationCenter){var c=[];window.Activity.ItemViews.NotificationCenter=Backbone.Marionette.LayoutView.extend({template:Handlebars.templates["notification-center"],tagName:"div",className:"notification-center-wrapper",events:{"click .notifications-badge-container":"toggleList"},childEvents:{"render:badge":"renderBadge","dismissed:notification":"renderBadge","dismissed:notificationList":"resize",
"added:notification":"renderBadge","read:notification":"removeAndClose"},regions:{Notifications:".notifications-container",NewNotification:".new-notification-container",Badge:".notifications-badge-container"},initialize:function(){this.notificationsView=new window.Activity.CollectionViews.Notification({collection:this.collection});this.notificationsBadgeView=new window.Activity.ItemViews.NotificationCenterBadge({model:new window.Activity.Models.NotificationCenterBadge});this.keepOpen=!1;this.mouseOverFunc=
_.bind(this.handleMouseOver,this);this.mouseOutFunc=_.bind(this.handleMouseOut,this);this.goToOrderHistFunc=_.bind(this.goToOrderHist,this);$(".li-masthead--ordhist").on("mouseover",this.mouseOverFunc);$(".li-masthead--ordhist").on("mouseout",this.mouseOutFunc);$("#ShellLayout_OrdHist_Btn").on("click",this.goToOrderHistFunc)},onDestroy:function(){$(".li-masthead--ordhist").off("mouseover",this.mouseOverFunc);$(".li-masthead--ordhist").off("mouseout",this.mouseOutFunc);$("#ShellLayout_OrdHist_Btn").off("click",
this.goToOrderHistFunc)},onRender:function(){this.Notifications.show(this.notificationsView);this.Badge.show(this.notificationsBadgeView);0<this.currentCount()&&$(".notifications-badge-container",this.$el).removeClass("hidden")},currentCount:function(){return this.notificationsView.$el.children(0).length},renderBadge:function(){this.notificationsBadgeView.model.set({numberNotifications:this.currentCount()});this.notificationsBadgeView.render();0>=this.currentCount()&&($(".notifications-badge-container").addClass("hidden"),
this.hideList())},resize:function(){this.hidden()||this.resizeList()},addNewNotification:function(a){if(0!=a.Id&&!this.notifExists(a.Id)){this.notificationsView.collection.add(a);var b=$(this.notificationsView.$el.children(0)[0]);b.addClass("notification-highlight");setTimeout(function(){b.removeClass("notification-highlight")},2500);c.push(a);1===c.length&&this.showNextNewNotif()}},showNextNewNotif:function(){0<c.length&&this.showNewNotif(c[0])},showNewNotif:function(a){this.hidden()?(this.newNotificationView&&
this.newNotificationView.destroy(),this.newNotificationView=new window.Activity.ItemViews.NewNotification({model:a}),this.listenTo(this.newNotificationView,"done:newnotification",function(){c.shift();this.showNextNewNotif()}),this.newNotificationView.render(),$(this.regions.NewNotification).append(this.newNotificationView.el),this.newNotificationView.showNewNotification()):c=[]},dismissNotification:function(a){var b=this.notificationsView.collection.get(a.NotificationId);null!=b&&(b.set("Status",
a.Status),this.notificationsView.render(),this.renderBadge(),this.resize())},notifExists:function(a){return null!=this.notificationsView.collection.get(a)},toggleList:function(a){a.stopPropagation();Backbone.trigger("click:notifBadge");this.clearTimer();this.hidden()&&0<this.currentCount()?(this.keepOpen=!0,this.showList("click")):(this.keepOpen=!1,this.hideList("badge click"))},clearTimer:function(){this.timerOff&&clearTimeout(this.timerOff);this.timer&&clearTimeout(this.timer)},handleMouseOver:function(){this.newNotificationShowing()||
(!this.hidden()||this.keepOpen?this.clearTimer():(this.keepOpen=!1,0<this.currentCount()&&(this.timer=setTimeout(this.showList.bind(null,"hover"),1100))))},handleMouseOut:function(){!this.hidden()&&!this.keepOpen?this.timerOff=setTimeout(this.hideList,450):this.clearTimer()},resizeList:function(){var a=$(".notifications-list").height(),b=0,d=0;$(".notifications-list").children().each(function(){if(4<=d)return!1;b+=$(this).outerHeight(!0);d+=1});$(".notifications-container").css({"max-height":b,height:a,
opacity:1})},showList:function(a){var b=$(".notifications-list").height(),d=0,c=0,f=4<$(".notifications-list").children().length;if(f){var e=document.createElement("div");$(e).css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"});document.body.appendChild(e);var g=e.offsetWidth-e.clientWidth;document.body.removeChild(e);$(".notifications-container").css({overflow:"scroll-y"});$(".notifications-list").css({width:$(".notifications-container").outerWidth()-g+"px"})}$(".notifications-list").children().each(function(){if(4<=
c)return!1;d+=$(this).outerHeight(!0);c+=1});$(".notifications-container").on("transitionend",function(){d<b&&$(".notifications-container").css({"overflow-y":"auto"});$(".notifications-container").off("transitionend")}).css({"overflow-y":f?"visible":"hidden","max-height":d,height:b,opacity:1});a&&Trkr.Trk(Trkr.UserActions.notification_center_show.Make(),Trkr.ActionAttributes.action_initiating_event.Make(a))},hideList:function(a){$(".notifications-container").on("transitionend",function(){$(".notifications-container").off("transitionend")}).css({"overflow-y":"hidden",
"max-height":0,height:0,opacity:0}).scrollTop(0);a&&Trkr.Trk(Trkr.UserActions.notification_center_hide.Make(),Trkr.ActionAttributes.action_initiating_event.Make(a))},removeAndClose:function(){this.renderBadge();this.hideList()},goToOrderHist:function(){this.clearTimer();this.hideList()},newNotificationShowing:function(){return 1<=$(".new-notification-container").css("opacity")},hidden:function(){return 1>$(".notifications-container").css("opacity")}})}})();


this.NotificationCenterWebPart=this.NotificationCenterWebPart||new function(){var d,e,a;this.WebPart_LoadCmpl=function(b){a&&(a.destroy(),e=a=null);b=b.NotificationCenterModel.NotificationList;e=new window.Activity.Collections.Notification;e.reset(b);a=new window.Activity.ItemViews.NotificationCenter({collection:e});a.render();$(".li-masthead--ordhist").append(a.el);$("#ShellLayout_OrdHist_Btn").removeAttr("title");var f=[];_.each(b,function(b){0===b.Status&&f.push(b.Id)});Trkr.Trk(Trkr.MinorActions.notifications_loaded.Make(),
[Trkr.ActionAttributes.notification_ids.Make(f),Trkr.ActionAttributes.notification_count.Make(f.length)])};$(document).on("click",function(b){!$(b.target).closest(".notifications-container").length&&(a&&"1"===$(".notifications-container")[0].style.opacity)&&(a.keepOpen=!1,a.hideList("page click"))});var g=function(b){a.dismissNotification(b);0==a.notificationsView.children.length&&a.hideList()},l=function(b){var a=h(b),c={};c.NotificationId=a;c.Status=1;k(c,1);b.forEach(function(b){var a={};a.NotificationId=
b;a.Status=1;g(a)})},h=function(b){for(var a="",c=0;c<b.length;c++)a=a+b[c]+";";return a=a.substring(0,a.length-1)},k=function(b,a){b.status=a;d&&(McMaster.CnxnMgr.AbortAjaxCnxn(d),d=null);var c;c=Cmn.AddQSNmVal("/HTTPHandlers/UpdateNotification.aspx","id",b.NotificationId);c=Cmn.AddQSNmVal(c,"status",a);var e=Cmn.GetCookieVal("vstrextrep").slice(0,-3);c=Cmn.AddQSNmVal(c,"visitorId",e);d=McMaster.CnxnMgr.PerformAjaxCnxn(c,{success:function(a){d=null},failure:function(){},abort:function(){d&&(McMaster.CnxnMgr.AbortAjaxCnxn(d),
d=null)},cnxnParm:{}})};McMaster.MsgMgr.AddSubscriber(McMaster.MsgMgrMsgs.Notification,function(b){b=new window.Activity.Models.Notification(b.MsgPayload().NotificationObject);a.addNewNotification(b)});McMaster.MsgMgr.AddSubscriber(McMaster.MsgMgrMsgs.NotificationStatusUpdate,function(a){g(a.MsgPayload().NotificationStatusUpdateObject)});McMaster.MsgMgr.AddSubscriber(McMaster.MsgMgrMsgs.DismissNotifs,function(a){l(a.MsgPayload().NotificationIds)});McMaster.MsgMgr.AddSubscriber(McMaster.MsgMgrMsgs.OrderPreviewExpanded,
function(){a&&(a.keepOpen=!1,a.hideList())})};


(function(){
window.mPageEmbeddedFiles=window.mPageEmbeddedFiles||{};var f=window.mPageEmbeddedFiles;f['activity/models/notification.js']=1;f['activity/itemviews/notification.js']=1;f['activity/models/notificationcenterbadge.js']=1;f['activity/itemviews/notificationcenterbadge.js']=1;f['activity/itemviews/newnotification.js']=1;f['activity/collections/notification.js']=1;f['activity/collectionviews/notification.js']=1;f['activity/itemviews/notificationcenter.js']=1;f['activity/notificationcenterwebpart.js']=1;})();

if (window.performance && performance.mark) performance.mark('scriptcombiner end: BqA9BrBAA8ASAmA0B6');
if (window.loadNextDeferredScript) window.loadNextDeferredScript();
